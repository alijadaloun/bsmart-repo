---
import type { HTMLTag } from 'astro/types';
import type { Widget } from '~/types';
import { twMerge } from 'tailwind-merge';
import Background from './Background.astro';

export interface Props extends Widget {
  containerClass?: string;
  ['as']?: HTMLTag;
}

const { id, isDark = false, containerClass = '', bg, as = 'section' } = Astro.props;

const WrapperTag = as;
---

<WrapperTag class="relative not-prose scroll-mt-[72px] widget-section" {...id ? { id } : {}}>
  <div class="absolute inset-0 pointer-events-none -z-[1]" aria-hidden="true">
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : <Background isDark={isDark} />}
    </slot>
  </div>
  <!-- Overlay for text readability - fades in on scroll -->
  <div class="widget-overlay absolute inset-0 bg-white/80 sm:bg-white/70 md:bg-white/65 dark:bg-black/50 dark:sm:bg-black/45 dark:md:bg-black/40 backdrop-blur-sm pointer-events-none z-0 opacity-0 transition-opacity duration-500 ease-in-out"></div>
  <div
    class:list={[
      twMerge(
        'relative mx-auto max-w-7xl px-4 sm:px-5 md:px-6 py-8 sm:py-12 md:py-16 lg:py-20 text-default intersect-once intersect-quarter intersect-no-queue motion-safe:lg:opacity-0 motion-safe:lg:intersect:animate-fade z-10',
        containerClass
      ),
      { dark: isDark },
    ]}
  >
    <slot />
  </div>
</WrapperTag>
